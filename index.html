<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Malla Curricular Ingeniería en Prevención de Riesgos</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #d7ead7;
      margin: 0;
      padding: 20px;
      color: #033603;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    .malla-container {
      display: flex;
      gap: 10px;
      overflow-x: auto;
      padding-bottom: 10px;
    
      width: 100vw;
      box-sizing: border-box;
    }
    .semestre {
      background-color: #a8d5a8;
      border: 2px solid #577d57;
      border-radius: 8px;
      padding: 10px;
      min-width: 220px;
      max-width: 220px;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      box-sizing: border-box;
      
    }
    .semestre h2 {
      margin-top: 0;
      margin-bottom: 12px;
      font-weight: 700;
      font-size: 1.1rem;
      text-align: center;
    }
    .materia {
      background-color: #d5edd5;
      border: 1.5px solid #9bcf9b;
      border-radius: 6px;
      padding: 8px;
      margin: 5px 0;
      width: 100%;
      display: flex;
      align-items: center;
      cursor: pointer;
      user-select: none;
      color: #033603;
      font-weight: 600;
      transition: background-color 0.3s, border-color 0.3s, color 0.3s;
      box-sizing: border-box;
    }
    .materia input[type="checkbox"] {
      margin-right: 10px;
      cursor: pointer;
      transform: scale(1.2);
    }
    .bloqueada {
      background-color: #c0c0c0 !important;
      border-color: #8a8a8a !important;
      color: #5a5a5a !important;
      cursor: not-allowed !important;
    }
    .bloqueada input[type="checkbox"] {
      pointer-events: none;
      cursor: not-allowed;
    }
    .completada {
      background-color: #c7d9f1 !important;
      border-color: #4971b8 !important;
      color: #1a2a5a !important;
      text-decoration: line-through;
    }
    .completada label {
      text-decoration: line-through;
    }
    .materia label {
      flex: 1;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Malla Curricular - Ingeniería en Prevención de Riesgos</h1>
  <div class="malla-container" id="malla"></div>

  <script>
    const semestres = [
      { nombre: "Primer Semestre", materias: ["Matemáticas","Taller integrado ABP","Salud ocupacional","Fundamentos de seg. Industrial","Química","Comunicación y aprendizaje","Herramientas de ofimáticas"] },
      { nombre: "Segundo Semestre", materias: ["Matemática aplicada","Protocolos MINSAL 1","Seguridad industrial 1","Riesgos en la Ind.Qca.","Inglés 1","Desarrollo personal"] },
      { nombre: "Tercer Semestre", materias: ["Física 1","Lab. Higiene industrial 1","Ergonómia 1","Seguridad industrial 2","Emergencias en la industria","Inglés 2","Cultura y sociedad"] },
      { nombre: "Cuarto Semestre", materias: ["Protocolos MINSAL 2","Lab. Higiene industrial 2","Ergonomía 2","Riesgos industriales","Emergencias civiles","Emprendimiento y empleabilidad","Sustentab. y medioambiente"] },
      { nombre: "Quinto Semestre", materias: ["Procesos productivos 1","Leyes laborales 1","Física 2","Elaboración de infor. técnicos","Leyes ambientales","Inglés 3"] },
      { nombre: "Sexto Semestre", materias: ["Procesos productivos 2","Leyes laborales 2","Laboratorio de EPP","Estadística y probabilidades","Energías renovables","Inglés 4","Habilidades comunicativas"] },
      { nombre: "Séptimo Semestre", materias: ["Interpretación de planos","Sistemas de gestión SSO","Ev. Proyectos de prevención","Plan experto trabajo en terreno","Control de riesgos ambientales"] },
      { nombre: "Octavo Semestre", materias: ["Sistemas de gestión integrado","Proyecto integrado final","Gestión hab. directivas","Sistemas de gestión ambiental","Práct. integrada competencias"] }
    ];

    const desbloqueos = {
      "s0-m2": ["s1-m1"],
      "s0-m3": ["s1-m2"],
      "s0-m4": ["s1-m3"],
      "s1-m1": ["s2-m1","s2-m2"],
      "s1-m2": ["s2-m3"],
      "s1-m3": ["s2-m4"],
      "s2-m3": ["s3-m3"],
      "s2-m4": ["s3-m4"],
      "s4-m0": ["s5-m0","s6-m0"],
      "s4-m1": ["s5-m1"],
      "s4-m4": ["s5-m4"],
      "s5-m4": ["s6-m4"],
      "s6-m1": ["s7-m0"],
      "s6-m4": ["s7-m3"],
    };

    let estado = JSON.parse(localStorage.getItem("mallaEstado")) || {};

    function crearMalla() {
      const container = document.getElementById("malla");
      container.innerHTML = "";

      semestres.forEach((semestre, sIndex) => {
        const divSem = document.createElement("div");
        divSem.className = "semestre";

        const h2 = document.createElement("h2");
        h2.textContent = semestre.nombre;
        divSem.appendChild(h2);

        semestre.materias.forEach((mat, mIndex) => {
          const id = `s${sIndex}-m${mIndex}`;
          const divMat = document.createElement("div");
          divMat.className = "materia";
          divMat.id = id;

          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.id = `${id}-chk`;
          checkbox.disabled = true;
          if (estado[id]) checkbox.checked = true;

          const label = document.createElement("label");
          label.htmlFor = `${id}-chk`;
          label.textContent = mat;

          divMat.appendChild(checkbox);
          divMat.appendChild(label);
          divSem.appendChild(divMat);
        });

        container.appendChild(divSem);
      });
    }

    function materiaDesbloqueada(id) {
      if (id.startsWith("s0-")) return true;

      // Desbloqueo especial 4to semestre
      if (["s3-m0","s3-m1","s3-m2"].includes(id) && estado["s2-m1"] && estado["s2-m2"]) return true;

      for (const [completadoId, desbloqueadas] of Object.entries(desbloqueos)) {
        if (desbloqueadas.includes(id) && estado[completadoId]) return true;
      }
      return false;
    }

    function actualizarEstadoVisual() {
      semestres.forEach((semestre, sIndex) => {
        semestre.materias.forEach((mat, mIndex) => {
          const id = `s${sIndex}-m${mIndex}`;
          const divMat = document.getElementById(id);
          const checkbox = document.getElementById(`${id}-chk`);

          if (estado[id]) {
            divMat.classList.add("completada");
            divMat.classList.remove("bloqueada");
            checkbox.disabled = false;
            checkbox.checked = true;
            return;
          }

          if (materiaDesbloqueada(id)) {
            divMat.classList.remove("bloqueada");
            checkbox.disabled = false;
            checkbox.checked = false;
          } else {
            divMat.classList.add("bloqueada");
            checkbox.disabled = true;
            checkbox.checked = false;
            divMat.classList.remove("completada");
          }
        });
      });
    }

    function manejarCambio(e) {
      const checkbox = e.target;
      const id = checkbox.id.replace("-chk", "");
      if (checkbox.checked) estado[id] = true;
      else estado[id] = false;

      localStorage.setItem("mallaEstado", JSON.stringify(estado));
      actualizarEstadoVisual();
    }

    function init() {
      crearMalla();
      actualizarEstadoVisual();
      document.querySelectorAll(".materia input[type=checkbox]").forEach(chk => {
        chk.addEventListener("change", manejarCambio);
      });
    }

    init();
  </script>
</body>
</html>
