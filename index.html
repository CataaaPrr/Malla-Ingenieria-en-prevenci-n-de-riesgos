<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Malla Curricular - Prevención de Riesgos</title>
  <style>
    body {
      background-color: #d8f3dc;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
      color: #1b4332;
    }

    .grid {
      display: flex;
      gap: 20px;
      overflow-x: auto;
      padding: 20px 0;
    }

    .semester {
      flex: 0 0 220px;
      background-color: #b7e4c7;
      border: 2px solid #40916c;
      border-radius: 10px;
      padding: 10px;
      box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
    }

    .semester h3 {
      text-align: center;
      color: #1b4332;
    }

    .subject {
      background-color: #e9f5ec;
      border: 1px solid #74c69d;
      border-radius: 5px;
      padding: 8px;
      margin: 5px 0;
      cursor: pointer;
      box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
    }

    .subject.locked {
      background-color: #ccc;
      border-color: #999;
      color: #666;
      cursor: not-allowed;
    }

    .subject.completed {
      background-color: #cfe6f3;
      border: 1px solid #5b9fcf;
      color: #1c3d5a;
      text-decoration: line-through;
    }
  </style>
</head>
<body>
  <h1>Malla Curricular - Ingeniería en Prevención de Riesgos</h1>
  <div class="grid" id="malla"></div>

  <script>
    const malla = {
      1: ["Matemáticas", "Taller integrado ABP", "Salud ocupacional", "Fundamentos de seg. Industrial", "Química", "Comunicación y aprendizaje", "Herramientas de ofimaticas"],
      2: ["Matemática aplicada", "Protocolos MINSAL 1", "Seguridad industrial 1", "Riesgos en la Ind.Qca.", "Inglés 1", "Desarrollo personal"],
      3: ["Física 1", "Lab. Higiene industrial 1", "Ergonomía 1", "Seguridad industrial 2", "Emergencias en la industria", "Inglés 2", "Cultura y sociedad"],
      4: ["Protocolos MINSAL 2", "Lab. Higiene industrial 2", "Ergonomía 2", "Riesgos industriales", "Emergencias civiles", "Emprendimiento y empleabilidad", "Sustentabilidad y medioambiente"],
      5: ["Procesos productivos 1", "Leyes laborales 1", "Física 2", "Elaboración de infor. Técnicos", "Leyes ambientales", "Inglés 3"],
      6: ["Procesos productivos 2", "Leyes laborales 2", "Laboratorio de EPP", "Estadística y probabilidades", "Energías renovables", "Inglés 4", "Habilidades comunicativas"],
      7: ["Interpretación de planos", "Sistemas de gestión SSO", "Ev. Proyectos de prevención", "Plan experto trabajo en terreno", "Control de riesgos ambientales"],
      8: ["Sistemas de gestión integrado", "Proyecto integrado final", "Gestión hab. Directivas", "Sistemas de gestión ambiental", "Práct. Integrada competencias"]
    };

    const dependencias = {
      "Salud ocupacional": ["Protocolos MINSAL 1"],
      "Protocolos MINSAL 1": ["Lab. Higiene industrial 1", "Ergonomía 1"],
      "Lab. Higiene industrial 1": ["Lab. Higiene industrial 2"],
      "Ergonomía 1": ["Ergonomía 2"],
      "Lab. Higiene industrial 2": ["Protocolos MINSAL 2"],
      "Ergonomía 2": ["Protocolos MINSAL 2"],

      "Fundamentos de seg. Industrial": ["Seguridad industrial 1"],
      "Seguridad industrial 1": ["Seguridad industrial 2"],
      "Seguridad industrial 2": ["Riesgos industriales"],

      "Química": ["Riesgos en la Ind.Qca."],
      "Riesgos en la Ind.Qca.": ["Emergencias en la industria"],
      "Emergencias en la industria": ["Emergencias civiles"],

      "Procesos productivos 1": ["Procesos productivos 2"],
      "Procesos productivos 2": ["Interpretación de planos"],

      "Leyes laborales 1": ["Leyes laborales 2"],
      "Sistemas de gestión SSO": ["Sistemas de gestión integrado"],

      "Leyes ambientales": ["Energías renovables"],
      "Energías renovables": ["Control de riesgos ambientales"],
      "Control de riesgos ambientales": ["Sistemas de gestión ambiental"]
    };

    const estado = {};

    function crearMalla() {
      const contenedor = document.getElementById("malla");
      for (let i = 1; i <= 8; i++) {
        const columna = document.createElement("div");
        columna.className = "semester";

        const titulo = document.createElement("h3");
        titulo.textContent = `Semestre ${i}`;
        columna.appendChild(titulo);

        malla[i].forEach(materia => {
          const item = document.createElement("div");
          item.className = "subject";
          item.textContent = materia;
          item.dataset.nombre = materia;
          item.dataset.semestre = i;
          item.dataset.locked = i !== 1 ? "true" : "false";
          item.dataset.completed = "false";
          if (i !== 1) item.classList.add("locked");
          item.addEventListener("click", () => toggle(item));
          estado[materia] = item;
          columna.appendChild(item);
        });

        contenedor.appendChild(columna);
      }
    }

    function toggle(item) {
      if (item.dataset.locked === "true") return;

      const completado = item.dataset.completed === "true";
      item.dataset.completed = (!completado).toString();
      item.classList.toggle("completed", !completado);

      actualizarDependencias();
    }

    function actualizarDependencias() {
      for (const [materia, item] of Object.entries(estado)) {
        // Verifica si tiene dependencias
        const dependents = Object.entries(dependencias).filter(([_, d]) => d.includes(materia)).map(([k]) => k);
        dependents.forEach(dep => {
          if (!estado[dep].classList.contains("completed")) {
            estado[materia].classList.add("locked");
            estado[materia].dataset.locked = "true";
            estado[materia].dataset.completed = "false";
            estado[materia].classList.remove("completed");
          }
        });
      }

      for (const [materia, dependents] of Object.entries(dependencias)) {
        const origen = estado[materia];
        if (origen.dataset.completed === "true") {
          dependents.forEach(dep => {
            estado[dep].classList.remove("locked");
            estado[dep].dataset.locked = "false";
          });
        } else {
          dependents.forEach(dep => {
            estado[dep].classList.add("locked");
            estado[dep].dataset.locked = "true";
            estado[dep].dataset.completed = "false";
            estado[dep].classList.remove("completed");
          });
        }
      }

      // Desbloqueo de semestres completos
      for (let i = 2; i <= 8; i++) {
        const todasPrevCompletadas = malla[i - 1].every(m => estado[m].dataset.completed === "true");
        malla[i].forEach(m => {
          if (todasPrevCompletadas && estado[m].dataset.locked === "true") {
            estado[m].classList.remove("locked");
            estado[m].dataset.locked = "false";
          }
        });
      }
    }

    crearMalla();
  </script>
</body>
</html>
